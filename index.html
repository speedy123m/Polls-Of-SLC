<!doctype html>

<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Vote who performed the best</title>
<style>
  :root{
    --bg: #0f1724;
    --card: rgba(255,255,255,0.04);
    --muted: rgba(255,255,255,0.6);
    --accent: #7c3aed; /* violet */
    --glass: rgba(255,255,255,0.03);
    --success: #10b981;
    --danger: #ef4444;
    --radius: 14px;
  }
  /* Light theme (toggle) */
  :root.light{
    --bg: #f6f7fb;
    --card: rgba(3,7,18,0.04);
    --muted: rgba(2,6,23,0.6);
    --accent: #4f46e5;
    --glass: rgba(2,6,23,0.02);
    --success: #059669;
    --danger: #dc2626;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    background: radial-gradient(1200px 600px at 10% 10%, rgba(124,58,237,0.08), transparent),
                radial-gradient(900px 400px at 90% 90%, rgba(16,185,129,0.03), transparent),
                var(--bg);
    color: #fff;
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
    padding:32px;
  }
  .wrap{
    max-width:900px;
    margin:24px auto;
    display:grid;
    gap:18px;
  }
  header{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:16px;
  }
  h1{
    margin:0;
    font-size:20px;
    letter-spacing:0.2px;
  }
  .sub{
    color:var(--muted);
    font-size:13px;
    margin-top:6px;
  }
  .card{
    background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent);
    border-radius:var(--radius);
    padding:18px;
    box-shadow: 0 6px 18px rgba(2,6,23,0.35);
    display:flex;
    gap:18px;
    align-items:flex-start;
  }
  .left{
    flex:1 1 360px;
  }
  .right{
    width:360px;
    min-width:260px;
  }
  form.poll{
    display:flex;
    flex-direction:column;
    gap:12px;
  }
  /* Radio cards */
  .option{
    display:flex;
    align-items:center;
    gap:12px;
    padding:12px;
    border-radius:12px;
    background:var(--glass);
    cursor:pointer;
    transition:all .18s ease;
    border:1px solid transparent;
  }
  .option:hover{ transform:translateY(-3px); box-shadow: 0 6px 20px rgba(2,6,23,0.25); }
  input[type="radio"]{ display:none; }
  input[type="radio"]:checked + label.option{
    border:1px solid rgba(124,58,237,0.22);
    box-shadow: 0 8px 30px rgba(124,58,237,0.06);
    transform:translateY(-3px);
  }
  .dot{
    width:34px; height:34px; border-radius:10px;
    display:grid; place-items:center;
    font-weight:700;
    background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent);
    color:var(--muted);
    border:1px solid rgba(255,255,255,0.03);
    font-size:13px;
  }
  .opt-text{
    flex:1;
  }
  .opt-title{
    font-weight:600;
    font-size:15px;
    margin-bottom:4px;
  }
  .opt-desc{ font-size:13px; color:var(--muted); }
  .controls{
    display:flex;
    gap:8px;
    margin-top:8px;
  }
  button.btn{
    border:0;
    padding:10px 14px;
    border-radius:10px;
    font-weight:600;
    cursor:pointer;
    transition:transform .12s ease, box-shadow .12s;
  }
  button.btn:active{ transform:translateY(1px) }
  .btn-primary{
    background: linear-gradient(90deg, var(--accent), rgba(79,70,229,0.9));
    color:white;
    box-shadow: 0 8px 30px rgba(79,70,229,0.12);
  }
  .btn-ghost{
    background:transparent;
    color:var(--muted);
    border:1px solid rgba(255,255,255,0.04);
  }
  .small{ padding:8px 12px; font-size:13px; }
  /* Results */
  .result{
    display:flex;
    flex-direction:column;
    gap:10px;
  }
  .res-row{
    display:flex;
    align-items:center;
    gap:12px;
    background:var(--glass);
    padding:10px;
    border-radius:10px;
  }
  .res-left{ width:110px; font-weight:700; font-size:14px; }
  .bar-wrap{ flex:1; background:rgba(255,255,255,0.03); height:12px; border-radius:8px; overflow:hidden; position:relative; }
  .bar{ height:100%; border-radius:8px 0 0 8px; transition:width .45s cubic-bezier(.2,.9,.2,1);} 
  .count{ width:56px; text-align:right; font-weight:600; font-size:13px; color:var(--muted); }
  .leader{
    display:flex;
    align-items:center;
    gap:10px;
    padding:8px 12px;
    border-radius:999px;
    background: linear-gradient(90deg, rgba(124,58,237,0.12), transparent);
    color:var(--accent);
    font-weight:700;
    font-size:13px;
  }
  .meta{
    display:flex;
    justify-content:space-between;
    align-items:center;
    gap:8px;
    color:var(--muted);
    margin-top:6px;
    font-size:13px;
  }
  /* tiny responsive */
  @media (max-width:780px){
    .card{ flex-direction:column; }
    .right{ width:100% }
  }
  /* little toast */
  .toast{
    position:fixed;
    left:50%;
    transform:translateX(-50%);
    bottom:22px;
    background:rgba(2,6,23,0.88);
    color:white;
    padding:10px 14px;
    border-radius:10px;
    font-weight:600;
    display:none;
  }
  .toast.show{ display:block; animation:pop .36s ease; }
  @keyframes pop{ from{transform:translate(-50%,10px) scale(.98);opacity:0} to{transform:translate(-50%,0) scale(1);opacity:1} }
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div>
      <h1>Vote who performed the best</h1>
      <div class="sub">Pick the subject you think performed best â€” see live results and the current leader.</div>
    </div>
    <div style="display:flex;gap:10px;align-items:center">
      <div id="leaderBadge" class="leader" aria-live="polite">No votes yet</div>
      <button id="themeToggle" class="btn btn-ghost small" title="Toggle light/dark">Toggle Theme</button>
    </div>
  </header>
  <div class="card">
    <div class="left">
      <form id="pollForm" class="poll" autocomplete="off">
        <!-- radio options injected by JS -->
        <div style="display:flex;gap:8px">
          <button type="submit" class="btn btn-primary">Vote</button>
          <button id="changeVoteBtn" type="button" class="btn btn-ghost small">Change Vote</button>
          <button id="undoBtn" type="button" class="btn btn-ghost small">Undo My Vote</button>
        </div>
      </form>
      <div class="meta">
        <div id="statusText">You haven't voted yet.</div>
        <div id="totalVotes" style="font-weight:700">Total: 0</div>
      </div>
    </div>
    <aside class="right">
      <div style="font-weight:700; margin-bottom:8px">Results</div>
      <div id="results" class="result">
        <!-- results injected by JS -->
      </div>
    </aside>
  </div>
</div>
<div id="toast" class="toast" role="status" aria-live="polite"></div>
<script>
(function(){
  const OPTIONS = ['Math','English','Chemistry','Physics'];
  // Helpers for localStorage persistence
  const STORAGE_KEY = 'poll_votes_v1';
  const VOTED_KEY = 'poll_voted_for_v1';
  function defaultVotes(){
    const obj = {};
    OPTIONS.forEach(o => obj[o] = 0);
    return obj;
  }
  function loadVotes(){
    try{
      const raw = localStorage.getItem(STORAGE_KEY);
      return raw ? JSON.parse(raw) : defaultVotes();
    }catch(e){ return defaultVotes(); }
  }
  function saveVotes(v){
    localStorage.setItem(STORAGE_KEY, JSON.stringify(v));
  }
  function loadVotedFor(){ return localStorage.getItem(VOTED_KEY) || null; }
  function saveVotedFor(name){ if(name) localStorage.setItem(VOTED_KEY, name); else localStorage.removeItem(VOTED_KEY); }
  // UI Elements
  const form = document.getElementById('pollForm');
  const resultsEl = document.getElementById('results');
  const statusText = document.getElementById('statusText');
  const totalVotesEl = document.getElementById('totalVotes');
  const leaderBadge = document.getElementById('leaderBadge');
  const toast = document.getElementById('toast');
  const changeVoteBtn = document.getElementById('changeVoteBtn');
  const undoBtn = document.getElementById('undoBtn');
  const themeToggle = document.getElementById('themeToggle');
  // Insert radio options into form
  function renderOptions(votedFor){
    // clear existing option nodes except controls (controls are after options; easy approach: rebuild form)
    form.innerHTML = '';
    OPTIONS.forEach((opt, idx) => {
      const id = 'opt_' + idx;
      const radio = document.createElement('input');
      radio.type = 'radio';
      radio.name = 'choice';
      radio.id = id;
      radio.value = opt;
      if(votedFor === opt) radio.checked = true;
      const label = document.createElement('label');
      label.className = 'option';
      label.htmlFor = id;
      label.innerHTML = `
        <div class="dot">${opt[0]}</div>
        <div class="opt-text">
          <div class="opt-title">${opt}</div>
          <div class="opt-desc">Vote for ${opt}</div>
        </div>
      `;
      form.appendChild(radio);
      form.appendChild(label);
    });
    // controls (include Undo)
    const ctrl = document.createElement('div');
    ctrl.style = 'display:flex;gap:8px;margin-top:10px';
    ctrl.innerHTML = `
      <button type="submit" class="btn btn-primary">Vote</button>
      <button id="changeVoteBtnLocal" type="button" class="btn btn-ghost small">Change Vote</button>
      <button id="undoBtnLocal" type="button" class="btn btn-ghost small">Undo My Vote</button>
    `;
    form.appendChild(ctrl);
    // rebind local controls to handlers
    form.querySelector('#changeVoteBtnLocal').addEventListener('click', onChangeVoteClick);
    form.querySelector('#undoBtnLocal').addEventListener('click', onUndoClick);
  }
  // Render results (bars + counts)
  function renderResults(votes){
    resultsEl.innerHTML = '';
    const total = Object.values(votes).reduce((a,b)=>a+b,0);
    totalVotesEl.textContent = 'Total: ' + total;
    OPTIONS.forEach(opt => {
      const row = document.createElement('div');
      row.className = 'res-row';
      const left = document.createElement('div');
      left.className = 'res-left';
      left.textContent = opt;
      const barWrap = document.createElement('div');
      barWrap.className = 'bar-wrap';
      const bar = document.createElement('div');
      bar.className = 'bar';
      // compute percent width
      const pct = total ? Math.round((votes[opt]/total)*100) : 0;
      bar.style.width = pct + '%';
      bar.style.background = `linear-gradient(90deg, var(--accent), rgba(124,58,237,0.75))`;
      const count = document.createElement('div');
      count.className = 'count';
      count.textContent = votes[opt] + ' â€¢ ' + pct + '%';
      barWrap.appendChild(bar);
      row.appendChild(left);
      row.appendChild(barWrap);
      row.appendChild(count);
      resultsEl.appendChild(row);
    });
  }
  // Leader calculation
  function findLeader(votes){
    const entries = Object.entries(votes);
    const max = Math.max(...entries.map(e=>e[1]));
    if(max === 0) return null;
    const leaders = entries.filter(e=>e[1] === max).map(e=>e[0]);
    return {leaders, max};
  }
  // UI state updates
  function updateUI(){
    const votes = loadVotes();
    const votedFor = loadVotedFor();
    renderOptions(votedFor);
    renderResults(votes);
    if(votedFor){
      statusText.textContent = `You voted for ${votedFor}.`;
    } else {
      statusText.textContent = `You haven't voted yet.`;
    }
    const leader = findLeader(votes);
    if(!leader){
      leaderBadge.textContent = 'No votes yet';
      leaderBadge.style.opacity = '0.95';
    } else if(leader.leaders.length === 1){
      leaderBadge.innerHTML = 'ðŸ† ' + leader.leaders[0] + ' (' + leader.max + ')';
      leaderBadge.style.opacity = '1';
    } else {
      leaderBadge.innerHTML = 'ðŸ¤ Tie: ' + leader.leaders.join(' & ') + ' (' + leader.max + ')';
      leaderBadge.style.opacity = '1';
    }
  }
  // Toast helper
  let toastTimer = null;
  function showToast(msg, ms=2200){
    toast.textContent = msg;
    toast.classList.add('show');
    clearTimeout(toastTimer);
    toastTimer = setTimeout(()=> toast.classList.remove('show'), ms);
  }
  // Event handlers
  function onVote(e){
    e.preventDefault();
    const formData = new FormData(form);
    const choice = formData.get('choice');
    if(!choice){ showShake(); showToast('Pick an option first'); return; }
    const votes = loadVotes();
    const votedFor = loadVotedFor();
    if(!votedFor){
      // first-time vote
      votes[choice] = (votes[choice] || 0) + 1;
      saveVotes(votes);
      saveVotedFor(choice);
      showToast(`Thanks â€” you voted for ${choice}`);
      updateUI();
    } else if (votedFor === choice){
      showToast(`You already voted for ${choice}`);
    } else {
      // change vote
      const ok = confirm(`You already voted for "${votedFor}". Change vote to "${choice}"?`);
      if(!ok) return;
      votes[votedFor] = Math.max(0, (votes[votedFor] || 1) - 1);
      votes[choice] = (votes[choice] || 0) + 1;
      saveVotes(votes);
      saveVotedFor(choice);
      showToast(`Changed vote to ${choice}`);
      updateUI();
    }
  }
  function onChangeVoteClick(){
    // allow user to change selection even if they've voted
    saveVotedFor(null);
    updateUI();
    showToast('You can now pick a new option and press Vote');
  }
  // NEW: Undo only the current user's vote (decrement that option and clear their voted flag)
  function onUndoClick(){
    const votedFor = loadVotedFor();
    if(!votedFor){
      showToast("You haven't voted yet.");
      return;
    }
    const votes = loadVotes();
    // decrement safely
    votes[votedFor] = Math.max(0, (votes[votedFor] || 1) - 1);
    saveVotes(votes);
    saveVotedFor(null);
    showToast(`Your vote for ${votedFor} was removed.`);
    updateUI();
  }
  function showShake(){
    // quick shaking animation on card
    const c = document.querySelector('.card');
    c.animate([{transform:'translateY(0)'},{transform:'translateY(-6px)'},{transform:'translateY(0)'}], {duration:260, easing:'ease-out'});
  }
  // theme toggle
  function initTheme(){
    const root = document.documentElement;
    const saved = localStorage.getItem('poll_theme');
    if(saved === 'light') root.classList.add('light');
    themeToggle.addEventListener('click', () => {
      if(root.classList.contains('light')){
        root.classList.remove('light');
        localStorage.removeItem('poll_theme');
      } else {
        root.classList.add('light');
        localStorage.setItem('poll_theme', 'light');
      }
    });
  }
  // bootstrap
  function init(){
    initTheme();
    updateUI();
    form.addEventListener('submit', onVote);
    // also bind top-level buttons (these are replaced on render, but keep for safety)
    changeVoteBtn && (changeVoteBtn.onclick = onChangeVoteClick);
    undoBtn && (undoBtn.onclick = onUndoClick);
  }
  init();
})();
</script>
</body>
</html>
